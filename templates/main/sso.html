<!DOCTYPE html>
<html>
<head>
    <title>SSO kluch</title>
</head>
<body>

<script>
async function pkce() {
  const a = new Uint8Array(32);
  crypto.getRandomValues(a);

  const v = btoa(String.fromCharCode(...a))
    .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/, '');

  const d = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(v));
  const c = btoa(String.fromCharCode(...new Uint8Array(d)))
    .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/, '');

  return {v,c};
}

(async ()=>{
  const {v,c} = await pkce();
  localStorage.setItem("pkce_verifier", v);

  const p = new URLSearchParams({
    clientId: "{{ client_id }}",
    redirectUri: "{{ redirect_uri }}",
    codeChallenge: c
  });

  window.location.replace("{{ sso_auth_url }}?" + p);
})();
</script>


</body>
</html>